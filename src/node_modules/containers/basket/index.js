import React from 'react'
import { connect } from 'react-redux'
import * as R from 'ramda'
import { Link } from 'react-router-dom' 

import IconButton from '@material-ui/core/IconButton'
import Typography from '@material-ui/core/Typography'
import { red, green, brown, deepOrange, blue } from '@material-ui/core/colors'
import Button from '@material-ui/core/Button'
import Grid from '@material-ui/core/Grid'
import Card from '@material-ui/core/Card'
import CardMedia from '@material-ui/core/CardMedia'
import { DeleteForever, Clear, Drafts } from '@material-ui/icons'
import { makeStyles } from '@material-ui/core/styles'
import Divider from '@material-ui/core/Divider'
import Paper from '@material-ui/core/Paper'

import {
  getBasketPhonesWithCount,
  getTotalBasketPrice
} from 'selectors'

import { 
  removePhoneFromBasket,
  basketCheckuot,
  cleanBasket
} from 'actions'

const useStyles = makeStyles((theme) => ({
  root: {
    flexDirection: 'column',
    justifyContent: "center",
    alignItems: "center",
  },
  row: {
    flexDirection: 'row',
    justifyContent: "space-around",
    alignItems: "center",
  },
  container: {
    width: '10em',
    height: '12em',
  },
  media: {
    width: '6.4em',
    height: '9em',
  },
  font: {
    fontWeight: 'bolder',
    fontSize: '1.5em',
  },
  divider: {
    border: `1px solid ${brown[300]}`,
  },
})); 

const Basket = ({
  phones, 
  totalPrice, 
  removePhoneFromBasket,
  basketCheckuot,
  cleanBasket
})=> {
  const classes = useStyles();
  const isBasketEmpty = R.isEmpty(phones)
  const renderContent = ()=> (
    <Typography component='div' align='center' style={{background: '#f7eae8'}}>
      
      {isBasketEmpty && <Typography 
                                    component='div' 
                                    style={{ fontWeight: 'bolder', fontSize: '2.5em', color: red[500]}}
                        >
                          Your shopping cart is empty
                        </Typography>}
            {phones.map((phone, index) => (
              <Card key={index} style={{margin: '.5em'}}>
                <Grid container derection='column'>
                  
                  <Grid container derection='row' justify='space-around' alignItems='center' style={{width: '100%'}}>
                    <Typography variant='subtitle1' component='div' style={{ color: brown[600], fontSize: '1.2em'}}>
                      {phone.name}
                    </Typography>
                    <Typography component='div' className={classes.font} style={{color: green['A700'], fontSize: '1.5em'}}>
                      ${phone.price}
                    </Typography>
                  </Grid>

                  <Divider className={classes.divider} style={{width: '100%',}}/>

                  <Grid container derection='row' justify='space-around' alignItems='center'>
                    <Card style={{background: 'white', margin: '.5em', borderRadius: '1em'}}>
                      <CardMedia 
                        image={phone.image}
                        title={phone.name}
                        className={classes.media}
                      />
                    </Card>

                    <Grid container derection='column' justify='space-between' alignItems='center' style={{width: '50%', height: '100%' }} >
                      <Typography variant='subtitle1' component='div' align='center' style={{width: '100%', marginTop: '1em'}}>
                          amount
                      </Typography>

                      <Typography component='div' align='center' style={{width: '100%', color: red[500], fontWeight: 'bolder', fontSize: '1.7em'}}>
                          {phone.count}
                      </Typography>

                      <Grid container direction="row" justify="flex-end" alignItems='center' style={{marginTop: '1em'}}>
                        <IconButton 
                          onClick={()=> removePhoneFromBasket(phone.id)}
                          style={{padding: '0px', border: 'none'}}
                        >
                          <Clear style={{ fontSize: '1.2em', color: brown[500]}}/>
                        </IconButton>
                      </Grid>

                    </Grid>
                  </Grid>
                </Grid>
              </Card>
            ))}
    </Typography>
  )
  
  const renderSidebar = ()=> (
    <Grid container direction='column' justify='space-around' alignItems='center' style={{height: '30em', background: '#f7eae8'}}>
      <Button variant="outlined" style={{background: blue[50]}}>
        <Link
              to='/' 
              style={{textDecoration: 'none', color: green['A700']}}
        >
          <Typography component='span' className={classes.font}>Continue shopping!</Typography>
        </Link>
      </Button>
      {R.not(isBasketEmpty) &&
          <Grid container derection='column' justify='center' alignItems='center' style={{width: '95%', height: '20em', border: `2px solid ${brown[300]}`, borderRadius: '.7em', background: '#ffffff'}}>
            <Button
                    variant='outlined'
                    onClick={cleanBasket}
                    style={{fontWeight: 'bolder', background: blue[50]}}
            >
              <Grid container derection='row' justify='space-between' alignItems='center' style={{width: '100%'}}>
                <Typography component="div" style={{marginTop: '.2em', color: red[500]}}>Clean cart</Typography>
                <DeleteForever style={{fontSize: '2em', color: deepOrange[300], marginLeft: '.5em'}}/>
              </Grid>
            </Button>

            <Typography component='div' style={{width: '100%'}}>
              <Grid container derection='row' justify='center' alignItems='center'>
                <Typography component='div' className={classes.font} style={{marginRight: '.5em', color: red[500]}}>Total:</Typography>
                <Typography component='div' className={classes.font} style={{color: green['A700']}}>${totalPrice}</Typography>
              </Grid>
            </Typography>

            <Button
                    variant='outlined'
                    onClick={()=> basketCheckuot(phones)}
                    style={{fontWeight: 'bolder', background: blue[50]}}
            >
              <Grid container derection='row' justify='space-between' alignItems='center' style={{width: '100%'}}>
                <Typography component="div" className={classes.font} style={{ color: blue['A700']}}>Checkout</Typography>
                <Drafts style={{fontSize: '2em', color: deepOrange[300], marginLeft: '.5em'}}/>
              </Grid>
            </Button>
            
          </Grid>
      }
    </Grid>
  )

  return (
        <Paper 
            elevation={10} 
            style={{
              width: '83%', 
              paddingTop: '.2em', 
              paddingBottom: '.2em', 
              margin: '1em',
              background: `linear-gradient(135deg, rgba(109,76,65,1) 0%, rgba(255,204,188,1) 100%)`,
            }}
        >
          <Grid 
               container 
               direction="row" 
               justify="center" 
               alignItems="flex-start" 
               style={{width: '100%', paddingTop: '1em', paddingBottom: '1em'}}
          >
            <Paper 
              elevation={10}
              style={{width: '21em', margin: '3%', paddingTop: '.25em', paddingBottom: '.25em', background: brown[800]}}
            >
              <Grid container className={classes.root} style={{width: '100%',}}>
                {renderContent()}
              </Grid>
            </Paper>

            <Paper 
              elevation={10}
              style={{width: '21em', margin: '3%', paddingTop: '.25em', paddingBottom: '.25em', background: brown[800]}}
            >
              <Grid container className={classes.root} style={{width: '100%',}}>
                {renderSidebar()}
              </Grid>
            </Paper>

          </Grid>
        </Paper>
  )
}

const mapStateToProps = state => {
  return {
    phones: getBasketPhonesWithCount(state),
    totalPrice: getTotalBasketPrice(state)
  }
}

const mapDispatchToProps = {
  removePhoneFromBasket,
  basketCheckuot,
  cleanBasket
}

export default connect(mapStateToProps, mapDispatchToProps)(Basket)