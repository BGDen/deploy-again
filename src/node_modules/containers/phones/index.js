import React from 'react'
import { connect } from 'react-redux'
import * as R from 'ramda'
import { Link } from 'react-router-dom'

import Card from '@material-ui/core/Card'
import CardHeader from '@material-ui/core/CardHeader'
import CardMedia from '@material-ui/core/CardMedia'
import Avatar from '@material-ui/core/Avatar'
import CardContent from '@material-ui/core/CardContent'

import Grid from '@material-ui/core/Grid'
import Button from '@material-ui/core/Button'
import Typography from '@material-ui/core/Typography'
import { red, green, deepOrange, brown } from '@material-ui/core/colors'
import Fab from '@material-ui/core/Fab'
import AddIcon from '@material-ui/icons/Add'
import SdCardRoundedIcon from '@material-ui/icons/SdCardRounded'

import { 
  fetchPhones, 
  loadMorePhones, 
  addPhoneToBasket,
  fetchCategories
} from 'actions'

import { getPhones } from 'selectors'
import Layout from 'containers/layout'

class Phones extends React.Component {
  componentDidMount(){
    this.props.fetchPhones()
    this.props.fetchCategories()
  }

  renderPhone (phone, index){
    const shortDescription = `${R.take(60, phone.description)}...`
    const {addPhoneToBasket} = this.props
    return (
      <Card key={index} style={{maxWidth: 270, margin: '1em'}}>
          <CardHeader
            avatar={
              <Avatar alt="Delta" style={{backgroundColor: brown[500]}}>
                <SdCardRoundedIcon />
              </Avatar>
            }
            title={phone.name}
            subheader={phone.memory}
          />
          <CardMedia
            image={phone.image}
            title={phone.name}
            style={{height: 0, paddingTop: '56.25%', backgroundSize: 'contain'}}
          />
          <CardContent style={{paddingBottom: 14}}>

            <Typography component="h3">
              <Link to={`/phones/${phone.id}`} style={{textDecoration: 'none', fontWeight: 'bolder', fontSize: '1.2em', color: brown[500]}}>
                {phone.name}
              </Link>
            </Typography>
            <Typography variant="body2" color="textSecondary" component="p">
              {shortDescription}
            </Typography>
            <Typography gutterBottom variant="h5" component="h2">
              <Grid container direction="row" justify="flex-end" style={{fontWeight: 'bolder', color: brown[300]}}>
                ${phone.price}
              </Grid>
            </Typography>

            <Grid container direction="row" justify="space-between" alignItems="center">
              <Button size="small" variant="outlined" style={{color: green['A700']}}>
                <Link to={`/phones/${phone.id}`} style={{textDecoration: 'none', color: green['A700'], fontWeight: 'bolder'}}>
                  more info
                </Link>
              </Button>
              <Button size="small" variant="outlined" style={{color: red['A700'], fontWeight: 'bolder'}}
                onClick={()=> addPhoneToBasket(phone.id)}
              >
                buy now
              </Button>
            </Grid>
            
          </CardContent>
      </Card>
    )
  }

  render() {
    const {phones, loadMorePhones} = this.props
    return(
      <Layout>
        <Grid container direction="row" justify="center" alignItems="center">
          {phones.map((phone, index)=> this.renderPhone(phone, index))}
        </Grid>
        <Fab color= "secondary" onClick={loadMorePhones} style={{background: deepOrange['300'], position: 'fixed', bottom: 10, right: 10}}>
          <AddIcon />
        </Fab>
      </Layout>
    )
  }
}

const mapStateToProps = (state, ownProps) => ({
  phones: getPhones(state, ownProps)
})

const mapDispatchToProps = {
  fetchPhones,
  loadMorePhones,
  addPhoneToBasket,
  fetchCategories
}

export default connect(mapStateToProps, mapDispatchToProps)(Phones)