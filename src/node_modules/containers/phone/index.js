import React from 'react'
import { connect } from 'react-redux'
import * as R from 'ramda'
import { Link } from 'react-router-dom'

import Card from '@material-ui/core/Card'
import Grid from '@material-ui/core/Grid'
import Typography from '@material-ui/core/Typography'
import Divider from '@material-ui/core/Divider'
import Paper from '@material-ui/core/Paper'
import CardMedia from '@material-ui/core/CardMedia'
import { red, brown, green, } from '@material-ui/core/colors'
import ListItem from '@material-ui/core/ListItem'

import {
  fetchPhoneById,
  addPhoneToBasket
} from 'actions'

import { getPhoneById } from 'selectors'
import BasketCart from 'components/basketCart'
import { BadgePoint } from 'component/AppBadgePoint'

class Phone extends React.Component{
  componentDidMount(){
    this.props.fetchPhoneById(this.props.match.params.id)
  }

  renderFields(){
    const {phone} = this.props

    const columnField = R.compose(
      R.toPairs,
      R.pick([
        'cpu',
        'camera',
        'size',
        'weight',
        'display',
        'battery',
        'memory'
      ])
    )(phone)

      return columnField.map(([key, value])=> (
        <Grid key={key} container direction="column">
          <Grid container direction="row" justify="flex-start" alignItems="center">
            <Typography variant='h4' component="h4" style={{marginRight: '2%'}}>
              {key}
            </Typography>
            <Typography color="textSecondary" component="div" style={{marginTop: '.5em'}}>
              {value}
            </Typography>
          </Grid>
          <Divider style={{marginBottom: '.5em'}}/>
        </Grid>
      ))
  }

  addToBasket = ()=> {
    this.props.addPhoneToBasket(this.props.phone.id)
  }

  renderSidebar(){ // addPhoneToBasket
    const {phone, } = this.props 

    return(
      <Grid 
            container 
            direction="column"
            justify="space-around" 
            alignItems='center'
            style={{height: '100%',}}
      >
        <Typography 
                    variant='h5' 
                    component='h5'
                    style={{marginTop: '1em', fontSize: '2em'}}
        >
          Quick shop
        </Typography>

        <Typography component='div'>
          <Grid container>
            <BasketCart />
          </Grid>
        </Typography>

        <Grid 
              container
              direction="column"
              justify="center" 
              alignItems='center'
        >
          <ListItem divider></ListItem>
            <Typography
                        variant='subtitle1' 
                        component='div' 
                        style={{fontWeight: 'bolder', fontSize: '2em'}}
            >
              {phone.name}
            </Typography>
            <Typography 
                        variant='subtitle2' 
                        component='div' 
                        style={{fontWeight: 'bolder', fontSize: '1.5em', color: red[500]}}
            >
              $ {phone.price}
            </Typography>
          <ListItem divider></ListItem>

        </Grid>

        <BadgePoint  addToBasket={this.addToBasket}/>

        <Link 
              to='/' 
              style={{textDecoration: 'none', fontSize: '1.4em', fontWeight: 'bolder', color: green['A700'],}}
        >
          Back to store
        </Link>

      </Grid>
    )
  }

  renderContent(){
    const {phone} = this.props
    return(
        <Grid 
              container 
              direction="row" 
              justify="space-around"
              alignItems='center' 
              style={{
                      width: '96%', 
                      background: `linear-gradient(90deg, rgba(177,142,130,1) 0%, rgba(255,231,223,1) 100%)`,
                    }}
        >
          <Card style={{width: '27.2%', height: '33em', background: 'white', margin: '1.2%', marginTop: '2.2%', borderRadius: '9%'}}>
            <CardMedia
                      image={phone.image}
                      title={phone.name}
                      style={{ height: '100%',}}
            />
          </Card>

          <Grid 
                container 
                direction="column" 
                justify="center" 
                alignItems='center' 
                style={{width: '27%', height: '33em',}}
          >
                {this.renderFields()}
            <Typography 
                        variant='h4' 
                        component="h4" 
                        style={{alignSelf:'flex-end', margin: '2%', fontWeight: 'bolder', color: red[500]}}
            >
              $ {phone.price}
            </Typography>
          </Grid>

          <Grid 
                container 
                direction="column" 
                justify="center" 
                alignItems='center' 
                style={{width: '20%', height: '33em',}}
          >
            <Typography 
                        variant='h4' 
                        component="h4"
                        style={{marginBottom: '.1em'}}
            >
              {phone.name}
            </Typography>

            <Typography 
                        variant='subtitle1' 
                        component="h5"
                        style={{padding: '.7em', fontSize: '1.4em'}}
            >
              {phone.description}
            </Typography>
          </Grid>

          <Grid 
               container
               direction='column'
               style={{width: '15%', height: '33em', margin: '2%'}}
          >
            {this.renderSidebar()}
          </Grid>

        </Grid>
    )
  }

  render(){
    const {phone} = this.props

    return(
        <Paper 
              elevation={10} 
              style={{width: '93%', paddingTop: '.2em', paddingBottom: '.2em', background: brown[800]}}
        >
          <Grid 
               container 
               direction="row" 
               justify="center" 
               alignItems="center" 
               style={{width: '100%', height: '100%'}}
          >
                {phone && this.renderContent()}
          </Grid>
        </Paper>
    )
  }
}

const mapStateToProps = state => {
  return{
    phone: getPhoneById(state, state.phonePage.id)
  }
}

const mapDispatchToProps = {
  fetchPhoneById,
  addPhoneToBasket
}

export default connect(mapStateToProps, mapDispatchToProps)(Phone)